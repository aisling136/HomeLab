argo-cd:
  global:
    domain: argocd.dex136.xyz
  configs:
    params:
      server.insecure: true
      controller.diff.server.side: true
    cm:
      kustomize.buildOptions: "--enable-helm --enable-alpha-plugins --enable-exec"
      statusbadge.enabled: 'true'
      resource.ignoreResourceUpdatesEnabled: true
      resource.customizations.ignoreResourceUpdates.all: |
        jsonPointers:
          - /status
      resource.customizations.ignoreDifferences.secret: |
        jsonPointers:
        - /data/tls.crt
        - /data/tls.key
        - /data/ca.crt
  server:
    ingress:
      enabled: true
      ingressClassName: internal
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
        hajimari.io/enable: "true"
        hajimari.io/icon: "wrench"
        hajimari.io/appName: "ArgoCD"
        hajimari.io/group: "system"
      tls: true
    metrics: &metrics
      enabled: true
      serviceMonitor:
        enabled: true
  applicationSet:
    metrics: *metrics
    ingress:
      enabled: true
      ingressClassName: external
      annotations:
        external-dns.alpha.kubernetes.io/hostname: external.dex136.xyz
      hostname: "argocd-wh.dex136.xyz"
      tls: true
  dex:
    enabled: false
  controller:
    metrics: *metrics
  repoServer:
    metrics: *metrics
    env:
      - name: SOPS_AGE_KEY_FILE
        value: /.config/sops/age/keys.txt
      - name: XDG_CONFIG_HOME
        value: /.config
    volumes:
      - name: custom-tools
        emptyDir: {}
      - name: sops-age
        secret:
          secretName: sops-age
          items:
            - key: keys.txt
              path: keys.txt
    initContainers:
      - name: install-ksops
        image: viaductoss/ksops:v4.3.1
        command: ["/bin/sh", "-c"]
        args:
          - echo "Installing KSOPS...";
            mv ksops /custom-tools/;
            mv kustomize /custom-tools/;
            echo "Done.";
        volumeMounts:
          - mountPath: /custom-tools
            name: custom-tools
    volumeMounts:
      - mountPath: /usr/local/bin/kustomize
        name: custom-tools
        subPath: kustomize
      - mountPath: /usr/local/bin/ksops
        name: custom-tools
        subPath: ksops
      - mountPath: /.config/sops/age
        name: sops-age
  redis:
    metrics: *metrics

