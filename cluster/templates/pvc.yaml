templates:
  - |
    {{- range $index, $pvc := .Values.pvcs }}
    ---
    apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      name: {{ $pvc.name }}
    spec:
      accessModes:
        - {{ default "ReadWriteOnce" $pvc.accessMode }}
      storageClassName: {{default "longhorn" $pvc.storageClassName }}
      resources:
        requests:
          storage: {{ $pvc.storage }}
    {{- if $pvc.volumeName }}
    ---
    apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: {{ $pvc.volumeName }}
      labels:
        recurring-job-group.longhorn.io/{{ $pvc.name }}: enabled
    spec:
      capacity:
        storage: {{ $pvc.storage }}
      accessModes:
        - {{ default "ReadWriteOnce" $pvc.accessMode }}
      persistentVolumeReclaimPolicy: Delete
      storageClassName: {{default "longhorn" $pvc.storageClassName }}
      volumeMode: Filesystem
    ---
    apiVersion: longhorn.io/v1beta2
    kind: RecurringJob
    metadata:
      name: {{ $pvc.name }}-snapshot
      namespace: longhorn
    spec:
      concurrency: 1
      cron: 37 8 * * *
      groups:
        - {{ $pvc.name }}
      labels: {}
      retain: 1
      task: snapshot
    {{- end }}
    {{- end }}
