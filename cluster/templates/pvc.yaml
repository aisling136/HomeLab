templates:
  - |
    {{- range $index, $sc := .Values.storageClass }}
    ---
    apiVersion: storage.k8s.io/v1
    kind: StorageClass
    metadata:
      name: {{ $sc.name }}
    provisioner: driver.longhorn.io
    parameters:
      dataLocality: disabled
      fromBackup: ''
      fsType: ext4
      numberOfReplicas: {{default 3 $sc.replicas | quote }}
      staleReplicaTimeout: '30'
      unmapMarkSnapChainRemoved: ignored
    reclaimPolicy: Delete
    allowVolumeExpansion: true
    volumeBindingMode: Immediate
    {{- end }}
    {{- range $index, $pvc := .Values.pvcs }}
    ---
    apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      name: {{ $pvc.name }}
    spec:
      accessModes:
        - {{ default "ReadWriteOnce" $pvc.accessMode }}
      storageClassName: {{default "longhorn" $pvc.storageClassName }}
      resources:
        requests:
          storage: {{ $pvc.storage }}
    {{- end }}
