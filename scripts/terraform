#!/bin/sh

apply=false
upgrade=false
init=false
cluster=false
external=false
while getopts "auice" arg; do
  case $arg in
    a) apply=true;;
    u) upgrade=true;;
    i) init=true;;
    c) cluster=true;;
    e) external=true;;
  esac
done

if $external; then
    if $upgrade; then
        terraform -chdir="./terraform/external-cluster-dependencies" init -upgrade
    elif $init; then
        terraform -chdir="./terraform/external-cluster-dependencies"
    fi
    if $apply; then
        terraform -chdir="./terraform/external-cluster-dependencies" apply -var-file=../../configs/generated_configs/external.tfvars -auto-approve
    else
        terraform -chdir="./terraform/external-cluster-dependencies" plan -var-file=../../configs/generated_configs/external.tfvars -no-color > configs/generated_configs/310.tfplan
        cat configs/generated_configs/310.tfplan
    fi
fi
if $cluster; then
    if $upgrade; then
        terraform -chdir="./terraform/talos" init -upgrade
    elif $init; then
        terraform -chdir="./terraform/talos" init
    fi
    if $apply; then
        terraform -chdir="./terraform/talos" apply -var-file=../../configs/generated_configs/cluster-build.tfvars -auto-approve
    else
        terraform -chdir="./terraform/talos" plan -var-file=../../configs/generated_configs/cluster-build.tfvars -no-color > configs/generated_configs/100.tfplan
        cat configs/generated_configs/100.tfplan
    fi
fi
